// Generated by CoffeeScript 1.6.3
var Plop, Plops;

Plop = (function() {
  function Plop(textures, x, y) {
    this.textures = textures;
    this.movie = null;
    this.animated = Math.random() < params.animatedRatio;
    this.angle = Math.random() * Math.PI * 2;
    this.dist = Math.random() * params.radius;
    this.speed = Math.random() * 0.15 + 0.02;
    this.offset = {
      x: Math.cos(this.angle) * this.dist,
      y: Math.sin(this.angle) * this.dist
    };
    this.setupMovie(x, y);
  }

  Plop.prototype.setupMovie = function(x, y) {
    if (this.animated) {
      this.movie = new PIXI.MovieClip(this.textures);
    } else {
      this.movie = new PIXI.Sprite(this.textures[Math.floor(Math.random() * this.textures.length)]);
    }
    this.movie.position.x = x + this.offset.x;
    this.movie.position.y = y + this.offset.y;
    this.movie.anchor.x = 0.5;
    this.movie.anchor.y = 0.5;
    this.movie.rotation = Math.random() * Math.PI;
    this.movie.animationSpeed = 0.2 + Math.random() * 0.8;
    return this.movie.tint = params.colors[Math.floor(Math.random() * params.colors.length)];
  };

  Plop.prototype.setPosition = function(x, y) {
    this.movie.position.x = x + this.offset.x;
    return this.movie.position.y = y + this.offset.y;
  };

  Plop.prototype.move = function(x, y) {
    this.angle += this.speed * 0.2;
    this.offset = {
      x: Math.cos(this.angle) * this.dist,
      y: Math.sin(this.angle) * this.dist
    };
    this.movie.position.x += (x + this.offset.x - this.movie.position.x) * this.speed;
    this.movie.position.y += (y + this.offset.y - this.movie.position.y) * this.speed;
    return this.movie.rotation += this.speed * 0.2;
  };

  return Plop;

})();

Plops = (function() {
  function Plops() {
    var i, id, plop, r, texture, _i, _j, _ref;
    this.view = new PIXI.DisplayObjectContainer;
    this.plopsArr = null;
    this.plopTextures = [];
    for (i = _i = 0; _i <= 39; i = ++_i) {
      id = '000' + i;
      id = id.substr(id.length - 4);
      texture = PIXI.Texture.fromFrame('plop/' + id);
      this.plopTextures.push(texture);
    }
    r = window.devicePixelRatio;
    this.plopsArr = [];
    for (i = _j = 0, _ref = params.numParticles; 0 <= _ref ? _j < _ref : _j > _ref; i = 0 <= _ref ? ++_j : --_j) {
      plop = new Plop(this.plopTextures, 0, 0);
      if (plop.animated) {
        plop.movie.gotoAndPlay(i % 26);
      }
      this.view.addChild(plop.movie);
      this.plopsArr.push(plop);
    }
  }

  Plops.prototype.setPosition = function(position) {
    var plop, _i, _len, _ref, _results;
    _ref = this.plopsArr;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      plop = _ref[_i];
      _results.push(plop.setPosition(position.x, position.y));
    }
    return _results;
  };

  Plops.prototype.update = function(position) {
    var plop, _i, _len, _ref, _results;
    _ref = this.plopsArr;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      plop = _ref[_i];
      _results.push(plop.move(position.x, position.y));
    }
    return _results;
  };

  return Plops;

})();
